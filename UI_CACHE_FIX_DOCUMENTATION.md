# UI Cache Issues After Update - Fix Documentation

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–ü—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ –≤–µ—Ä—Å—ñ—é 1.5.7 –¥–µ—è–∫—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Å–∫–∞—Ä–∂–∏–ª–∏—Å—è –Ω–∞ "–∑–ª—ñ—Ç–ª–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å":
- –ë—ñ–ª–∏–π –µ–∫—Ä–∞–Ω –∑–∞–º—ñ—Å—Ç—å UI
- –ï–ª–µ–º–µ–Ω—Ç–∏ –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è
- –°—Ç–∞—Ä–∞ –≤–µ—Ä—Å—ñ—è CSS/JS –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è
- –ö–Ω–æ–ø–∫–∏ –Ω–µ –ø—Ä–∞—Ü—é—é—Ç—å

## üîç –ü—Ä–∏—á–∏–Ω–∏

### 1. **Electron Cache**
Electron –∫–µ—à—É—î HTML/CSS/JS —Ñ–∞–π–ª–∏, —ñ –ø—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î —Å—Ç–∞—Ä—ñ –≤–µ—Ä—Å—ñ—ó –∑ –∫–µ—à—É –∑–∞–º—ñ—Å—Ç—å –Ω–æ–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤.

### 2. **–ù–µ–ø–æ–≤–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è**
–ü—Ä–∏ portable –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ —Ñ–∞–π–ª–∏ –∑–∞–º—ñ–Ω—é—é—Ç—å—Å—è —á–µ—Ä–µ–∑ .bat —Å–∫—Ä–∏–ø—Ç, —è–∫–∏–π –º–æ–∂–µ –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —è–∫—â–æ:
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–∫—Ä–∏–≤ –ø—Ä–æ–≥—Ä–∞–º—É —Ä–∞–Ω—ñ—à–µ —á–∞—Å—É
- –ê–Ω—Ç–∏–≤—ñ—Ä—É—Å –∑–∞–±–ª–æ–∫—É–≤–∞–≤ bat —Ñ–∞–π–ª
- –ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –ø—Ä–∞–≤

### 3. **–ö–æ–Ω—Ñ–ª—ñ–∫—Ç –≤–µ—Ä—Å—ñ–π assets**
Vite –≥–µ–Ω–µ—Ä—É—î —Ñ–∞–π–ª–∏ –∑ —Ö–µ—à–∞–º–∏ (`index-B5rsGJAO.js`), –∞–ª–µ —Å—Ç–∞—Ä–∏–π HTML –º–æ–∂–µ –ø–æ—Å–∏–ª–∞—Ç–∏—Å—è –Ω–∞ —ñ–Ω—à–µ —ñ–º'—è.

## ‚úÖ –†—ñ—à–µ–Ω–Ω—è

### 1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è –∫–µ—à—É –ø—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è**

**–§–∞–π–ª:** `electron/services/updateService.ts`

```typescript
private async clearElectronCache(): Promise<void> {
  const { session } = require('electron')
  
  // –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ —Ç–∏–ø–∏ –∫–µ—à—É
  await session.defaultSession.clearCache()
  await session.defaultSession.clearStorageData({
    storages: ['cookies', 'filesystem', 'indexdb', 'shadercache', 
               'websql', 'serviceworkers', 'cachestorage', 'localstorage']
  })
  await session.defaultSession.clearAuthCache()
}
```

**–í–∏–∫–ª–∏–∫:**
- –ü—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è portable
- –ü—ñ—Å–ª—è –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è patch
- –ü–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º –¥–æ–¥–∞—Ç–∫—É

### 2. **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–µ—Ä—Å—ñ—ó –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É**

**–§–∞–π–ª:** `electron/main.ts`

```typescript
async function checkAndClearCacheIfNeeded() {
  const currentVersion = app.getVersion()
  const lastVersion = storage.getSetting('app.lastVersion', null)
  
  // –Ø–∫—â–æ –≤–µ—Ä—Å—ñ—è –∑–º—ñ–Ω–∏–ª–∞—Å—å - –æ—á–∏—â–∞—î–º–æ –∫–µ—à
  if (lastVersion && lastVersion !== currentVersion) {
    console.log(`üîÑ –û–Ω–æ–≤–ª–µ–Ω–Ω—è: ${lastVersion} ‚Üí ${currentVersion}`)
    await session.defaultSession.clearCache()
    await session.defaultSession.clearStorageData({...})
  }
  
  storage.setSetting('app.lastVersion', currentVersion)
}
```

**–õ–æ–≥—ñ–∫–∞:**
- –ü—Ä–∏ –∫–æ–∂–Ω–æ–º—É –∑–∞–ø—É—Å–∫—É –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –≤–µ—Ä—Å—ñ—è
- –Ø–∫—â–æ –≤–µ—Ä—Å—ñ—è –∑–º—ñ–Ω–∏–ª–∞—Å—å ‚Üí –æ—á–∏—â–µ–Ω–Ω—è –∫–µ—à—É
- –ó–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –ø–æ—Ç–æ—á–Ω–∞ –≤–µ—Ä—Å—ñ—è –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏

### 3. **–í–µ—Ä—Å—ñ–π–æ–≤–∞–Ω–∏–π hash –≤ URL**

**–§–∞–π–ª:** `electron/main.ts`

```typescript
// –î–æ–¥–∞—î–º–æ –≤–µ—Ä—Å—ñ—é —è–∫ hash –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –∫–µ—à—É–≤–∞–Ω–Ω—é
mainWindow.loadFile(htmlPath, {
  hash: appVersion.replace(/\./g, '-') // 1.5.7 ‚Üí 1-5-7
})
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- URL: `file:///.../index.html#1-5-7`
- –ë—Ä–∞—É–∑–µ—Ä —Å–ø—Ä–∏–π–º–∞—î —Ü–µ —è–∫ –Ω–æ–≤—É —Å—Ç–æ—Ä—ñ–Ω–∫—É
- –ö–µ—à —Å—Ç–∞—Ä–æ—ó –≤–µ—Ä—Å—ñ—ó —ñ–≥–Ω–æ—Ä—É—î—Ç—å—Å—è

## üìã Workflow –æ–Ω–æ–≤–ª–µ–Ω–Ω—è (–æ–Ω–æ–≤–ª–µ–Ω–∏–π)

### Portable Update:
```
1. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è portable.zip
2. –†–æ–∑–ø–∞–∫—É–≤–∞–Ω–Ω—è
3. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è backup
4. –ó–∞–º—ñ–Ω–∞ —Ñ–∞–π–ª—ñ–≤
5. –û—á–∏—â–µ–Ω–Ω—è —Ç–∏–º—á–∞—Å–æ–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤
6. ‚ú® –ù–û–í–û–ï: –û—á–∏—â–µ–Ω–Ω—è –∫–µ—à—É Electron
7. –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–¥–∞—Ç–∫—É
8. ‚ú® –ù–û–í–û–ï: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–µ—Ä—Å—ñ—ó –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
9. ‚ú® –ù–û–í–û–ï: –ü–æ–≤—Ç–æ—Ä–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è –∫–µ—à—É —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
```

### Patch Update:
```
1. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è patch.zip
2. –†–æ–∑–ø–∞–∫—É–≤–∞–Ω–Ω—è
3. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è backup
4. –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è patch
5. –û—á–∏—â–µ–Ω–Ω—è —Ç–∏–º—á–∞—Å–æ–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤
6. ‚ú® –ù–û–í–û–ï: –û—á–∏—â–µ–Ω–Ω—è –∫–µ—à—É Electron
7. –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
8. ‚ú® –ù–û–í–û–ï: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–µ—Ä—Å—ñ—ó –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
```

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –û–Ω–æ–≤–ª–µ–Ω–Ω—è portable
```bash
1. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ v1.5.6
2. –û–Ω–æ–≤–∏—Ç–∏ –¥–æ v1.5.7 (portable)
3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏: "üßπ –û—á–∏—â–µ–Ω–Ω—è –∫–µ—à—É Electron..."
4. –ü—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É: "üîÑ –û–Ω–æ–≤–ª–µ–Ω–Ω—è: 1.5.6 ‚Üí 1.5.7"
5. UI –ø–æ–≤–∏–Ω–µ–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏—Å—å –∫–æ—Ä–µ–∫—Ç–Ω–æ
```

### –°—Ü–µ–Ω–∞—Ä—ñ–π 2: –û–Ω–æ–≤–ª–µ–Ω–Ω—è patch
```bash
1. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ v1.5.6
2. –û–Ω–æ–≤–∏—Ç–∏ –¥–æ v1.5.7 (patch)
3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –æ—á–∏—â–µ–Ω–Ω—è –∫–µ—à—É
4. UI –∫–æ—Ä–µ–∫—Ç–Ω–∏–π –ø—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É
```

### –°—Ü–µ–Ω–∞—Ä—ñ–π 3: –ü–æ–≤—Ç–æ—Ä–Ω–∏–π –∑–∞–ø—É—Å–∫
```bash
1. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ v1.5.7
2. –ó–∞–∫—Ä–∏—Ç–∏ —ñ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –∑–Ω–æ–≤—É
3. –ù–ï –ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ –æ—á–∏—â–µ–Ω–Ω—è –∫–µ—à—É (–≤–µ—Ä—Å—ñ—è –Ω–µ –∑–º—ñ–Ω–∏–ª–∞—Å—å)
4. UI –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è —à–≤–∏–¥–∫–æ
```

## üìä –õ–æ–≥–∏

### –ü—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ:
```
[UpdateService] üßπ –û—á–∏—â–µ–Ω–Ω—è –∫–µ—à—É Electron...
[UpdateService]   ‚úì –û—á–∏—â–µ–Ω–æ cache
[UpdateService]   ‚úì –û—á–∏—â–µ–Ω–æ storage data
[UpdateService]   ‚úì –û—á–∏—â–µ–Ω–æ auth cache
[UpdateService] ‚úÖ –ö–µ—à Electron –ø–æ–≤–Ω—ñ—Å—Ç—é –æ—á–∏—â–µ–Ω–æ
```

### –ü—Ä–∏ –ø–µ—Ä—à–æ–º—É –∑–∞–ø—É—Å–∫—É –ø—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:
```
üîÑ –í–∏—è–≤–ª–µ–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–µ—Ä—Å—ñ—ó: 1.5.6 ‚Üí 1.5.7
üßπ –û—á–∏—â–µ–Ω–Ω—è –∫–µ—à—É –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º –∑ UI...
‚úÖ –ö–µ—à —É—Å–ø—ñ—à–Ω–æ –æ—á–∏—â–µ–Ω–æ
```

### –ü—Ä–∏ –∑–≤–∏—á–∞–π–Ω–æ–º—É –∑–∞–ø—É—Å–∫—É:
```
(–Ω–µ–º–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—Ä–æ –∫–µ—à - –≤–µ—Ä—Å—ñ—è –Ω–µ –∑–º—ñ–Ω–∏–ª–∞—Å—å)
```

## ‚úÖ –ü–µ—Ä–µ–≤–∞–≥–∏ —Ä—ñ—à–µ–Ω–Ω—è

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è**: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ —Ä–æ–±–∏—Ç—å –Ω—ñ—á–æ–≥–æ –≤—Ä—É—á–Ω—É
2. **–ü–æ–¥–≤—ñ–π–Ω–∏–π –∑–∞—Ö–∏—Å—Ç**: 
   - –û—á–∏—â–µ–Ω–Ω—è –ø—ñ–¥ —á–∞—Å –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
   - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É (—è–∫—â–æ relaunch –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–≤)
3. **–í–µ—Ä—Å—ñ–π–æ–≤–∞–Ω–∏–π URL**: –î–æ–¥–∞—Ç–∫–æ–≤–∏–π –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ –∫–µ—à—É –±—Ä–∞—É–∑–µ—Ä–∞
4. **–õ–æ–≥—É–≤–∞–Ω–Ω—è**: –ú–æ–∂–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç—É–≤–∞—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∏
5. **–ë–µ–∑–ø–µ—á–Ω–æ**: –ü–æ–º–∏–ª–∫–∏ –æ—á–∏—â–µ–Ω–Ω—è –∫–µ—à—É –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ñ

## üîÆ –ú–∞–π–±—É—Ç–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

- [ ] –î—ñ–∞–ª–æ–≥ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É
- [ ] –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å—Ç–∞–Ω—É UI –ø–µ—Ä–µ–¥ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π rollback –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ —Ñ–∞–π–ª—ñ–≤ –ø—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

## üìù –í–µ—Ä—Å—ñ—è

**–î–æ–¥–∞–Ω–æ –≤:** 1.5.7 (hotfix)

**–§–∞–π–ª–∏ –∑–º—ñ–Ω–µ–Ω–æ:**
- `electron/services/updateService.ts` - –º–µ—Ç–æ–¥ `clearElectronCache()`
- `electron/main.ts` - —Ñ—É–Ω–∫—Ü—ñ—è `checkAndClearCacheIfNeeded()`
- `electron/main.ts` - –≤–µ—Ä—Å—ñ–π–æ–≤–∞–Ω–∏–π hash –≤ `loadFile()`

**–¢–µ—Å—Ç–∏:** –û—á—ñ–∫—É—î—Ç—å—Å—è –∑–≤–æ—Ä–æ—Ç–Ω—ñ–π –∑–≤'—è–∑–æ–∫ –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –ø—ñ—Å–ª—è deploy
