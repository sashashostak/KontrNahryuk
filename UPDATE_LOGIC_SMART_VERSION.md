# Update Logic - Smart Version Detection

## üìã –û–ø–∏—Å

–ü–æ–∫—Ä–∞—â–µ–Ω–∞ –ª–æ–≥—ñ–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω—å, —è–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–∞—î –æ–ø—Ç–∏–º–∞–ª—å–Ω–∏–π —Å–ø–æ—Å—ñ–± –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ä—ñ–∑–Ω–∏—Ü—ñ –≤–µ—Ä—Å—ñ–π.

## üéØ –õ–æ–≥—ñ–∫–∞ —Ä–æ–±–æ—Ç–∏

### 1Ô∏è‚É£ –†—ñ–∑–Ω–∏—Ü—è = 1 –≤–µ—Ä—Å—ñ—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 1.5.6 ‚Üí 1.5.7)
- ‚úÖ –®—É–∫–∞—î **–ø—Ä—è–º–∏–π patch** –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
- üì¶ –†–æ–∑–º—ñ—Ä: ~7-10 MB
- ‚ö° –®–≤–∏–¥–∫–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

### 2Ô∏è‚É£ –†—ñ–∑–Ω–∏—Ü—è > 1 –≤–µ—Ä—Å—ñ—ó (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 1.5.5 ‚Üí 1.5.7)
- ‚ö†Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ –ø—Ä–æ–º—ñ–∂–Ω—ñ –≤–µ—Ä—Å—ñ—ó
- üì¶ –û–¥—Ä–∞–∑—É –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î **portable –≤–µ—Ä—Å—ñ—é**
- üíæ –†–æ–∑–º—ñ—Ä: ~150 MB
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç—É—î –ø–æ–≤–Ω–µ —Ç–∞ –∫–æ—Ä–µ–∫—Ç–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

### 3Ô∏è‚É£ –†—ñ–∑–Ω–∏—Ü—è –≤ major/minor (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 1.4.x ‚Üí 1.5.x)
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è —è–∫ –≤–µ–ª–∏–∫–∞ —Ä—ñ–∑–Ω–∏—Ü—è
- üì¶ –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î **portable –≤–µ—Ä—Å—ñ—é**
- üîí –ó–∞–ø–æ–±—ñ–≥–∞—î –ø—Ä–æ–±–ª–µ–º–∞–º —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ

## üîß –¢–µ—Ö–Ω—ñ—á–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è

### –ù–æ–≤–∏–π –º–µ—Ç–æ–¥: `getVersionDifference()`

```typescript
private getVersionDifference(fromVersion: string, toVersion: string): number {
  // –ü–∞—Ä—Å–∏–Ω–≥ –≤–µ—Ä—Å—ñ–π (1.5.6 ‚Üí [1, 5, 6])
  const fromParts = cleanFrom.split('.').map(p => parseInt(p, 10) || 0)
  const toParts = cleanTo.split('.').map(p => parseInt(p, 10) || 0)

  // –Ø–∫—â–æ major –∞–±–æ minor –≤—ñ–¥—Ä—ñ–∑–Ω—è—é—Ç—å—Å—è ‚Üí –≤–µ–ª–∏–∫–∞ —Ä—ñ–∑–Ω–∏—Ü—è
  if (fromParts[0] !== toParts[0] || fromParts[1] !== toParts[1]) {
    return 999
  }

  // –†—ñ–∑–Ω–∏—Ü—è –≤ patch –≤–µ—Ä—Å—ñ—ó
  return Math.abs(toParts[2] - fromParts[2])
}
```

### –û–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥—ñ–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

```typescript
// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä—ñ–∑–Ω–∏—Ü—ñ
const versionDiff = this.getVersionDifference(currentVersion, latestVersion)

if (versionDiff > 1) {
  // –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ portable
  const portableAsset = findPortableAsset()
  await downloadAndInstall(portableAsset)
} else {
  // –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–Ω–∞–π—Ç–∏ patch
  const patchAsset = findPatchAsset()
  await downloadAndInstall(patchAsset)
}
```

## üìä –ü—Ä–∏–∫–ª–∞–¥–∏

### –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –ü–æ—Å–ª—ñ–¥–æ–≤–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
```
–ü–æ—Ç–æ—á–Ω–∞: 1.5.6
–î–æ—Å—Ç—É–ø–Ω–∞: 1.5.7
–†—ñ–∑–Ω–∏—Ü—è: 1
–†—ñ—à–µ–Ω–Ω—è: ‚úÖ Patch (7 MB)
```

### –°—Ü–µ–Ω–∞—Ä—ñ–π 2: –ü—Ä–æ–ø—É—â–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è
```
–ü–æ—Ç–æ—á–Ω–∞: 1.5.5
–î–æ—Å—Ç—É–ø–Ω–∞: 1.5.7
–†—ñ–∑–Ω–∏—Ü—è: 2
–†—ñ—à–µ–Ω–Ω—è: üì¶ Portable (150 MB)
–ü—Ä–∏—á–∏–Ω–∞: –ü—Ä–æ–ø—É—â–µ–Ω–æ v1.5.6
```

### –°—Ü–µ–Ω–∞—Ä—ñ–π 3: –í–µ–ª–∏–∫–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
```
–ü–æ—Ç–æ—á–Ω–∞: 1.4.9
–î–æ—Å—Ç—É–ø–Ω–∞: 1.5.7
–†—ñ–∑–Ω–∏—Ü—è: major/minor
–†—ñ—à–µ–Ω–Ω—è: üì¶ Portable (150 MB)
–ü—Ä–∏—á–∏–Ω–∞: –ó–º—ñ–Ω–∞ minor –≤–µ—Ä—Å—ñ—ó
```

## üé® UI –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å –∑—Ä–æ–∑—É–º—ñ–ª—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:

### –ü—Ä–∏ —Ä—ñ–∑–Ω–∏—Ü—ñ > 1:
```
‚ö†Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ –±—ñ–ª—å—à–µ 1 –≤–µ—Ä—Å—ñ—ó (2). –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è portable –≤–µ—Ä—Å—ñ—è
üì¶ –®—É–∫–∞—é portable —Ñ–∞–π–ª –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è...
‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ portable —Ñ–∞–π–ª: KontrNahryuk-v1.5.7-portable.zip
üíæ –†–æ–∑–º—ñ—Ä: 147.54 MB
```

### –ü—Ä–∏ —Ä—ñ–∑–Ω–∏—Ü—ñ = 1:
```
üìä –†—ñ–∑–Ω–∏—Ü—è –≤–µ—Ä—Å—ñ–π: 1 (1.5.6 ‚Üí 1.5.7)
üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è patch —Ñ–∞–π–ª—É: KontrNahryuk-v1.5.6-to-v1.5.7-patch.zip
üíæ –†–æ–∑–º—ñ—Ä: 7.42 MB
```

## ‚úÖ –ü–µ—Ä–µ–≤–∞–≥–∏

1. **–ï–∫–æ–Ω–æ–º—ñ—è —Ç—Ä–∞—Ñ—ñ–∫—É**: Patch —Ñ–∞–π–ª–∏ –¥–ª—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–∏—Ö –æ–Ω–æ–≤–ª–µ–Ω—å
2. **–ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å**: Portable –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö —Å—Ç—Ä–∏–±–∫—ñ–≤ –≤–µ—Ä—Å—ñ–π
3. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–º**: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –≤–∏–±–∏—Ä–∞—î, —Å–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ –≤–∏–∑–Ω–∞—á–∞—î
4. **–ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å**: –ó—Ä–æ–∑—É–º—ñ–ª—ñ –ª–æ–≥–∏ –ø—Ä–æ –ø—Ä–∏–π–Ω—è—Ç—ñ —Ä—ñ—à–µ–Ω–Ω—è

## üîÑ Workflow

```mermaid
graph TD
    A[–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω—å] --> B{–Ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è?}
    B -->|–ù—ñ| C[–ü—Ä–æ–≥—Ä–∞–º–∞ –∞–∫—Ç—É–∞–ª—å–Ω–∞]
    B -->|–¢–∞–∫| D[–û–±—á–∏—Å–ª–∏—Ç–∏ —Ä—ñ–∑–Ω–∏—Ü—é –≤–µ—Ä—Å—ñ–π]
    D --> E{–†—ñ–∑–Ω–∏—Ü—è > 1?}
    E -->|–¢–∞–∫| F[–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ Portable]
    E -->|–ù—ñ| G[–®—É–∫–∞—Ç–∏ Patch]
    G --> H{Patch –∑–Ω–∞–π–¥–µ–Ω–æ?}
    H -->|–¢–∞–∫| I[–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ Patch]
    H -->|–ù—ñ| F
    F --> J[–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è]
    I --> J
    J --> K[–ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–æ–¥–∞—Ç–æ–∫]
```

## üìù Changelog

**Version:** Added in 1.5.7

**Changes:**
- –î–æ–¥–∞–Ω–æ `getVersionDifference()` –º–µ—Ç–æ–¥
- –û–Ω–æ–≤–ª–µ–Ω–æ `downloadUpdate()` –∑ –ª–æ–≥—ñ–∫–æ—é –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ä—ñ–∑–Ω–∏—Ü—ñ
- Portable –≤–µ—Ä—Å—ñ—è –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ —Ä—ñ–∑–Ω–∏—Ü—ñ > 1
- –ü–æ–∫—Ä–∞—â–µ–Ω—ñ –ª–æ–≥–∏ —Ç–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É

## üêû –í—ñ–¥–æ–º—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è

- –ü—Ä–∞—Ü—é—î —Ç—ñ–ª—å–∫–∏ –¥–ª—è semantic versioning (major.minor.patch)
- –õ–∞–Ω—Ü—é–∂–æ–∫ –ø–∞—Ç—á—ñ–≤ (—á–µ—Ä–µ–∑ –ø—Ä–æ–º—ñ–∂–Ω—ñ –≤–µ—Ä—Å—ñ—ó) –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –¥–ª—è –º–∞–π–±—É—Ç–Ω—ñ—Ö –≤–µ—Ä—Å—ñ–π
- Portable –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–∂–µ –±—É—Ç–∏ –ø–æ–≤—ñ–ª—å–Ω–∏–º –Ω–∞ —Å–ª–∞–±–∫–æ–º—É —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ

## üîÆ –ú–∞–π–±—É—Ç–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

- [ ] UI –¥—ñ–∞–ª–æ–≥ –≤–∏–±–æ—Ä—É (patch vs portable)
- [ ] –ö–µ—à—É–≤–∞–Ω–Ω—è portable —Ñ–∞–π–ª—ñ–≤
- [ ] –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —Ä–æ–∑–º—ñ—Ä—É —Ñ–∞–π–ª—ñ–≤ –ø–µ—Ä–µ–¥ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º
- [ ] –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–µ—Ä–µ—Ä–≤–∞–Ω–∏—Ö –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å
