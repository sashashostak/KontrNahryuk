# 🔄 Система автоматичних оновлень

## Огляд системи

KontrNahryuk використовує `electron-updater` для автоматичного оновлення. Система інтегрована з GitHub Releases для безпечного та надійного розповсюдження оновлень.

## Архітектура оновлень

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Розробник     │    │  GitHub Actions │    │   Користувачі   │
│                 │    │                 │    │                 │
│ git push tag    │───▶│  Збірка релізу  │───▶│ Автооновлення   │
│ v1.0.x         │    │  Публікація     │    │ Сповіщення      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## Налаштування для розробника

### 1. GitHub Repository
Створіть репозиторій на GitHub і оновіть `package.json`:
```json
{
  "build": {
    "publish": [{
      "provider": "github",
      "owner": "YOUR_GITHUB_USERNAME",
      "repo": "ukrainian-document-processor",
      "private": false
    }]
  }
}
```

### 2. GitHub Actions
Файл `.github/workflows/release.yml` автоматично:
- Збирає застосунок при створенні нового тегу
- Публікує реліз на GitHub Releases
- Завантажує інсталятори

### 3. Створення релізу

```bash
# Оновити версію в package.json
npm version patch  # або minor/major

# Створити і пуш тег
git push --tags

# GitHub Actions автоматично створить реліз
```

## Як працює для користувачів

### Автоматична перевірка
- ✅ Перевірка кожні 4 години
- ✅ Перевірка при запуску (через 3 секунди)
- ✅ Ручна перевірка через кнопку

### Процес оновлення
1. **Виявлення оновлення** - сповіщення користувача
2. **Завантаження** - прогрес-бар і відсотки
3. **Готове до встановлення** - пропозиція перезапуску
4. **Встановлення** - автоматичне після перезапуску

### UI компоненти
```html
<!-- Додати в index.html -->
<div id="update-notification"></div>
<link rel="stylesheet" href="styles/update-notification.css">
```

```typescript
// Ініціалізація в main.ts
import { UpdateNotification } from './components/UpdateNotification'

// Після завантаження DOM
new UpdateNotification('update-notification')
```

## Безпека

### Перевірка підпису
- ✅ GitHub автоматично підписує релізи
- ✅ electron-updater перевіряє цілісність
- ✅ HTTPS завантаження

### Захист від атак
- ✅ Оновлення тільки з офіційного репозиторію
- ✅ Перевірка версій (тільки новіші)
- ✅ Валідація метаданих релізу

## Тестування оновлень

### Локальне тестування
```bash
# Збірка для тестування
npm run build
npm run dist:win

# Встановити тестову версію
# Змінити версію в package.json
# Створити новий реліз
# Тестувати автооновлення
```

### Стратегії тестування
- 🧪 **Alpha** - внутрішнє тестування (`prerelease: true`)
- 🔄 **Beta** - обмежене тестування
- 🚀 **Stable** - масове розповсюдження

## Моніторинг і аналітика

### Логування
```typescript
// У electron/services/autoUpdate.ts
autoUpdater.on('update-available', (info) => {
  console.log('Update available:', info.version)
  // Відправити аналітику
})
```

### Метрики оновлень
- Скільки користувачів оновилося
- Час завантаження оновлень
- Помилки оновлення
- Популярні версії

## Усунення проблем

### Часті проблеми
1. **Помилка мережі** - перевірити інтернет
2. **Підпис не валідний** - перевірити GitHub токен
3. **Версія не знайдена** - перевірити тег релізу

### Логи помилок
```typescript
autoUpdater.on('error', (error) => {
  console.error('Update error:', error)
  // Зберегти лог для діагностики
})
```

## Альтернативні методи розповсюдження

### 1. Прямі посилання
```
https://github.com/USER/REPO/releases/latest/download/Ukrainian-Document-Processor-Setup.exe
```

### 2. Власний сервер оновлень
- Хостити `latest.yml` і файли самостійно
- Більше контролю, але більше відповідальності

### 3. Windows Store / Mac App Store
- Офіційні магазини додатків
- Автоматичні оновлення через ОС

## Версійність релізів

### Семантичне версіювання
- `v1.0.0` - перша стабільна версія
- `v1.0.1` - виправлення помилок
- `v1.1.0` - нові функції
- `v2.0.0` - кардинальні зміни

### Тестові релізи
- `v1.0.1-alpha.1` - альфа тестування  
- `v1.0.1-beta.1` - бета тестування
- `v1.0.1-rc.1` - кандидат релізу